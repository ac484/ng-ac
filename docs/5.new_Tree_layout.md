## New Tree: Modern Layout Implementation (Angular 20 + Material 3 + Container Queries)

This file tree is a pragmatic, directly-applicable plan to land the layout modernization described in `docs/0.angular_material_layout_guide.md` onto the current codebase structure from `docs/0.TREE.md`.

Guiding stack: Angular 20 standalone components + Angular Material 20 (M3) + CDK BreakpointObserver + CSS Container Queries (MDN) + existing `app-shell` foundation.

### 1) New and updated files

```text
src/
  styles/
    app-shell/
      _container-queries.scss           # New: container-type/name utilities + CQ helpers
      _layout-grid.scss                 # New: CSS Grid helpers and layout tokens wiring
      index.scss                        # Update: import new partials at the end

  app/
    shared/
      constants/
        layout/
          layout.constants.ts           # New: BREAKPOINTS, CONTAINER_SIZES, SPACING tokens

      services/
        material/
          modern-breakpoint.service.ts  # New: Thin CDK BreakpointObserver wrapper for M3 breakpoints

    interface/
      components/
        layout/
          layout-grid/
            layout-grid.component.ts    # New: Generic grid wrapper from guide (columns, gap, padding)
            index.ts

          app-shell-modern/
            app-shell-modern.component.ts  # New: Modernized shell using mat-sidenav-container + CQ
            app-shell-modern.component.scss
            index.ts

      pages/
        app-shell-demo/
          app-shell-demo.page.ts        # Update: showcase switching to app-shell-modern and layout-grid
```

Notes
- Prefer adding new components alongside existing ones to enable incremental rollout; no breaking renames.
- Reuse existing Material setup; do not introduce new theming systems.

### 2) File intents (what each does)
- `styles/app-shell/_container-queries.scss`: defines `.cq-{name}` helpers to set `container-type: inline-size` and named containers; provides `@container` usage examples.
- `styles/app-shell/_layout-grid.scss`: grid presets (1â€“4 cols, auto-fit/fill) and variables wiring; complements the component.
- `shared/constants/layout/layout.constants.ts`: source-of-truth tokens used by services/components (breakpoints, container sizes, spacing).
- `shared/services/material/modern-breakpoint.service.ts`: wraps `BreakpointObserver` with Material 3 breakpoint sets plus convenience booleans/computed signals.
- `interface/components/layout/layout-grid/*`: a thin presentational component exposing `columns | 'auto-fit' | 'auto-fill'`, `gap`, `padding`, `minWidth` inputs.
- `interface/components/layout/app-shell-modern/*`: a shell using `<mat-sidenav-container>` with responsive `mode` and CQ width tuning for the sidenav.
- `interface/pages/app-shell-demo/app-shell-demo.page.ts`: demo page toggling between legacy and modern shell and showing `layout-grid` usage.

### 3) Minimal content sketches (to keep implementation grounded)

SCSS: `styles/app-shell/_container-queries.scss`
```scss
.cq { container-type: inline-size; }
.cq--name-#{$name} { container-name: #{$name}; }

/* Pragmatic helpers */
.cq-small  { container-name: small;  }
.cq-medium { container-name: medium; }
.cq-large  { container-name: large;  }
```

SCSS: `styles/app-shell/_layout-grid.scss`
```scss
.layout-grid { display: grid; gap: var(--grid-gap, 1rem); padding: var(--grid-padding, 1rem); }
.layout-grid--1-col { grid-template-columns: 1fr; }
.layout-grid--2-col { grid-template-columns: repeat(2, 1fr); }
.layout-grid--3-col { grid-template-columns: repeat(3, 1fr); }
.layout-grid--4-col { grid-template-columns: repeat(4, 1fr); }
.layout-grid--auto-fit { grid-template-columns: repeat(auto-fit, minmax(var(--min-width, 300px), 1fr)); }
.layout-grid--auto-fill { grid-template-columns: repeat(auto-fill, minmax(var(--min-width, 300px), 1fr)); }
```

TS: `shared/constants/layout/layout.constants.ts`
```ts
export const LAYOUT_CONSTANTS = {
  BREAKPOINTS: {
    XS: '(max-width: 599.98px)',
    SM: '(min-width: 600px) and (max-width: 959.98px)',
    MD: '(min-width: 960px) and (max-width: 1279.98px)',
    LG: '(min-width: 1280px) and (max-width: 1919.98px)',
    XL: '(min-width: 1920px)'
  },
  CONTAINER: { SMALL: 400, MEDIUM: 800, LARGE: 1200 },
  SPACING: { XS: '0.5rem', SM: '1rem', MD: '1.5rem', LG: '2rem', XL: '3rem' }
} as const;
```

TS: `shared/services/material/modern-breakpoint.service.ts`
```ts
import { Injectable, computed, inject, signal } from '@angular/core';
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';

@Injectable({ providedIn: 'root' })
export class ModernBreakpointService {
  private readonly bo = inject(BreakpointObserver);
  readonly isHandset = signal(this.bo.isMatched(Breakpoints.Handset));
  readonly isTablet  = signal(this.bo.isMatched(Breakpoints.Tablet));
  readonly isWeb     = signal(this.bo.isMatched(Breakpoints.Web));
  readonly layout = computed(() => ({
    isHandset: this.isHandset(),
    isTablet: this.isTablet(),
    isWeb: this.isWeb(),
    isMobile: this.isHandset() || this.isTablet(),
    isDesktop: this.isWeb()
  }));
}
```

TS: `interface/components/layout/layout-grid/layout-grid.component.ts`
```ts
import { Component, Input } from '@angular/core';

@Component({
  selector: 'app-layout-grid',
  standalone: true,
  template: `
    <div class="layout-grid" [ngClass]="gridClass" [ngStyle]="gridStyles">
      <ng-content />
    </div>
  `
})
export class LayoutGridComponent {
  @Input() columns: 1 | 2 | 3 | 4 | 'auto-fit' | 'auto-fill' = 1;
  @Input() minWidth = '300px';
  @Input() gap = '1rem';
  @Input() padding = '1rem';

  get gridClass(): string { return typeof this.columns === 'number' ? `layout-grid--${this.columns}-col` : `layout-grid--${this.columns}`; }
  get gridStyles(): Record<string, string> { return { '--min-width': this.minWidth, '--grid-gap': this.gap, '--grid-padding': this.padding }; }
}
```

TS/HTML/SCSS: `interface/components/layout/app-shell-modern/app-shell-modern.component.ts|scss`
```ts
import { Component, ViewChild } from '@angular/core';
import { MatSidenav, MatSidenavContainer } from '@angular/material/sidenav';
import { ModernBreakpointService } from '@/app/shared/services/material/modern-breakpoint.service';

@Component({
  selector: 'app-shell-modern',
  standalone: true,
  template: `
    <mat-sidenav-container class="app-shell cq cq-medium">
      <mat-sidenav #drawer [mode]="(bps.layout().isMobile ? 'over' : 'side')" [opened]="!bps.layout().isMobile">
        <ng-content select="[shell-sidenav]"></ng-content>
      </mat-sidenav>
      <mat-sidenav-content>
        <ng-content />
      </mat-sidenav-content>
    </mat-sidenav-container>
  `,
  styles: [`
    .app-shell { height: 100vh; }
    mat-sidenav { width: 256px; }
    @container (max-width: 600px) { mat-sidenav { width: 208px; } }
  `]
})
export class AppShellModernComponent {
  constructor(public readonly bps: ModernBreakpointService) {}
  @ViewChild('drawer') drawer?: MatSidenav;
  @ViewChild(MatSidenavContainer) container?: MatSidenavContainer;
}
```

### 4) Minimal edits to existing files
- `styles/app-shell/index.scss`: add imports at end
```scss
@use 'container-queries';
@use 'layout-grid';
```
- `pages/app-shell-demo/app-shell-demo.page.ts`: showcase `AppShellModernComponent` and `LayoutGridComponent` in the demo route (no breaking change to other pages).

### 5) Generation commands (pnpm)
```bash
pnpm ng g c interface/components/layout/layout-grid --standalone --flat=false --skip-tests
pnpm ng g c interface/components/layout/app-shell-modern --standalone --flat=false --skip-tests
pnpm ng g s shared/services/material/modern-breakpoint --flat --skip-tests
pnpm ng g g shared/constants/layout --flat=false # create folder; then add layout.constants.ts manually
```

### 6) Rollout checklist
- Add files and imports as listed above.
- Wire modern shell in `app-shell-demo` for validation; keep existing shell for other routes.
- Validate breakpoints and CQ behavior on XS/SM/MD/LG/XL.
- Keep CSS changes scoped to the new components to avoid regressions.

This plan aligns with the latest Angular Material 20 sidenav/grid and CDK breakpoints, plus MDN Container Queries, and fits the existing DDD-oriented project layout without over-idealization.


