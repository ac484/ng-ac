# NG-AC 清晰佈局檔案樹（最小實施版）

## 目標
- 登入前佈局與登入後佈局清楚分離（PassportLayout vs MainAppLayout）。
- 佈局容器與視覺組件留在 Interface 層；佈局的「契約/型別」歸屬 Shared 層。
- 僅保留必要檔案與結構，遵守極簡主義，避免過度設計。

## 🚀 清晰檔案樹（聚焦佈局，與 0.TREE 對齊）

```text
src/app/
  app.component.ts                 # 根：僅承載 router-outlet
  app.routes.ts                    # 路由：/auth/** → PassportLayout；/app/** → MainAppLayout

  interface/
    layouts/
      main-app/
        main-app.layout.ts         # 登入後主容器：Shell + Header + Sidebar + TabNav + Main + Footer
        index.ts
      passport/
        passport.layout.ts         # 登入前容器
        index.ts

    components/
      layout/
        header/
          header.component.ts
          index.ts
        sidebar/
          sidebar.component.ts     # 佈局用側欄（已從 Shared 整合至此）
          sidebar.component.html
          sidebar.component.scss
          index.ts
        footer/
          footer.component.ts
          index.ts
        layout-grid/
          layout-grid.component.ts # 可選；純 UI 佈局小組件
          index.ts
        app-shell-modern/
          app-shell-modern.component.ts # 可選；Shell 輕薄封裝
          index.ts

      common/
        tab-navigation/
          tab-navigation.component.ts
          tab-navigation.component.scss
          index.ts

    pages/                         # 功能頁（dashboard/user/tab-demo/...）
      ...

  shared/
    constants/
      layout/
        layout.constants.ts        # 斷點/間距/容器尺寸等佈局常量
      sidebar.constants.ts
      tab/
        tab.constants.ts
      index.ts

    interfaces/
      layout/
        layout.interface.ts        # 佈局系統契約（必要時）
        sidebar.interface.ts       # Migrate: 從 shared 根搬遷至此（若尚未）
      app-shell/
        app-shell.interface.ts
        offline.interface.ts
        index.ts
      tab/
        tab.interface.ts
        index.ts
      index.ts

    services/
      material/
        material-layout.service.ts
        material-theme.service.ts
        modern-breakpoint.service.ts
        index.ts
      cache.service.ts
      index.ts

    utils/
      storage.util.ts
      tab/
        tab.util.ts
      index.ts
```

## 路由規範
- `/auth/**` → `PassportLayoutComponent`（登入前）
- `/app/**` → `MainAppLayoutComponent`（登入後主容器）

## 遷移與調整（最小集）
- Sidebar 已從 `shared/components/sidebar/*` 整合到 `interface/components/layout/sidebar/*`。
- 如 `shared/interfaces/sidebar.interface.ts` 仍位於 `shared/interfaces/` 根層，請移至 `shared/interfaces/layout/sidebar.interface.ts`，維持「佈局契約在 Shared」的一致性。
- 其餘 Shared/Interface 結構與 `docs/0.TREE.md` 對齊，無需新增多餘目錄或檔案。

## 驗收清單
- [ ] `/auth/**` 正確使用 `PassportLayoutComponent`
- [ ] `/app/**` 正確使用 `MainAppLayoutComponent`
- [ ] `interface/components/layout/sidebar/*` 為唯一側欄實作
- [ ] 佈局契約集中於 `shared/interfaces/layout/*`
- [ ] 不存在重複或語意重疊的佈局檔案

---

原始指南保留如下（供參考）：

# Angular 20 現代化佈局檔案樹 - 落地實施指南

## 📋 專案現狀分析

基於 `docs/0.TREE.md` 分析，專案已具備：
- ✅ Angular 20.0.0 + Material 20
- ✅ DDD 六層架構完整
- ✅ Standalone Components 架構
- ✅ 基礎佈局組件（app-shell, header, sidebar, footer）
- ✅ Material 組件庫完整

## 🚀 現代化佈局升級檔案樹

```
ng-ac/
├─ 📁 專案配置
│  ├── package.json                    # ✅ Angular 20 + Material 20
│  ├── angular.json                    # ✅ 現代化構建配置
│  ├── tsconfig.json                   # ✅ TypeScript 5.8.2 嚴格模式
│  ├── tailwind.config.js              # ✅ Tailwind CSS 4.1
│  └── firebase.json                   # ✅ Firebase 11 配置
│
├─ 📁 源代碼 (src/)
│  ├── 📁 應用根目錄
│  │  ├── app.component.ts            # ✅ Standalone 組件
│  │  ├── app.config.ts               # ✅ 現代化配置
│  │  ├── app.routes.ts               # ✅ 懶加載路由
│  │  └── main.ts                     # ✅ 無 Zone.js 啟動
│  │
│  │  ├── 📁 核心層 (Core Layer)
│  │  │  ├── guards.ts               # ✅ 路由守衛聚合
│  │  │  ├── interceptors.ts         # ✅ HTTP 攔截器聚合
│  │  │  ├── services.ts             # ✅ 核心服務聚合
│  │  │  ├── startup/                # ✅ 應用啟動服務
│  │  │  └── i18n/                   # ✅ 國際化服務
│  │  │
│  │  ├── 📁 領域層 (Domain Layer)
│  │  │  ├── entities/               # ✅ 業務實體
│  │  │  ├── value-objects/          # ✅ 值對象
│  │  │  ├── aggregates/             # ✅ 聚合根
│  │  │  ├── repositories/           # ✅ 倉儲接口
│  │  │  ├── services/               # ✅ 領域服務
│  │  │  ├── events/                 # ✅ 領域事件
│  │  │  └── specifications/         # ✅ 規格模式
│  │  │
│  │  ├── 📁 應用層 (Application Layer)
│  │  │  ├── use-cases/              # ✅ 業務用例
│  │  │  ├── services/               # ✅ 應用服務
│  │  │  ├── commands/               # ✅ CQRS 命令
│  │  │  ├── queries/                # ✅ CQRS 查詢
│  │  │  ├── dto/                    # ✅ 數據傳輸對象
│  │  │  ├── validators/             # ✅ 輸入驗證器
│  │  │  └── mappers/                # ✅ 對象映射器
│  │  │
│  │  ├── 📁 基礎設施層 (Infrastructure Layer)
│  │  │  ├── persistence/            # ✅ 數據持久化
│  │  │  ├── external-services/      # ✅ 外部服務
│  │  │  ├── messaging/              # ✅ 消息處理
│  │  │  ├── caching/                # ✅ 緩存實現
│  │  │  ├── logging/                # ✅ 日誌實現
│  │  │  ├── monitoring/             # ✅ 監控實現
│  │  │  └── config/                 # ✅ 配置管理
│  │  │
│  │  ├── 📁 接口層 (Interface Layer) - 🆕 佈局現代化重點
│  │  │  ├── components/             # ✅ UI 組件
│  │  │  │  ├── common/              # ✅ 通用組件
│  │  │  │  │  ├── button/           # ✅ 按鈕組件
│  │  │  │  │  ├── input/            # ✅ 輸入組件
│  │  │  │  │  ├── modal/            # ✅ 模態組件
│  │  │  │  │  └── tab-navigation/   # ✅ 標籤導航
│  │  │  │  │
│  │  │  │  ├── forms/               # ✅ 表單組件
│  │  │  │  │  ├── login-form/       # ✅ 登入表單
│  │  │  │  │  └── user-form/        # ✅ 用戶表單
│  │  │  │  │
│  │  │  │  ├── layout/              # 🆕 佈局組件現代化
│  │  │  │  │  ├── app-shell/        # ✅ App Shell 架構
│  │  │  │  │  │  ├── app-shell.component.ts
│  │  │  │  │  │  ├── app-shell.component.scss
│  │  │  │  │  │  └── index.ts
│  │  │  │  │  │
│  │  │  │  │  ├── header/           # ✅ 頁頭組件
│  │  │  │  │  │  ├── header.component.ts
│  │  │  │  │  │  └── index.ts
│  │  │  │  │  │
│  │  │  │  │  ├── sidebar/          # ✅ 側邊欄組件
│  │  │  │  │  │  ├── sidebar.component.ts
│  │  │  │  │  │  └── index.ts
│  │  │  │  │  │
│  │  │  │  │  ├── footer/           # ✅ 頁腳組件
│  │  │  │  │  │  ├── footer.component.ts
│  │  │  │  │  │  └── index.ts
│  │  │  │  │  │
│  │  │  │  │  └── 🆕 現代化佈局組件
│  │  │  │  │      ├── layout-grid/          # 🆕 CSS Grid 佈局組件
│  │  │  │  │      │  ├── layout-grid.component.ts
│  │  │  │  │      │  ├── layout-grid.component.scss
│  │  │  │  │      │  └── index.ts
│  │  │  │  │      │
│  │  │  │  │      ├── layout-flex/           # 🆕 Flexbox 佈局組件
│  │  │  │  │      │  ├── layout-flex.component.ts
│  │  │  │  │      │  ├── layout-flex.component.scss
│  │  │  │  │      │  └── index.ts
│  │  │  │  │      │
│  │  │  │  │      ├── container-query/       # 🆕 Container Queries 組件
│  │  │  │  │      │  ├── container-query.component.ts
│  │  │  │  │      │  ├── container-query.component.scss
│  │  │  │  │      │  └── index.ts
│  │  │  │  │      │
│  │  │  │  │      ├── responsive-container/   # 🆕 響應式容器組件
│  │  │  │  │      │  ├── responsive-container.component.ts
│  │  │  │  │      │  ├── responsive-container.component.scss
│  │  │  │  │      │  └── index.ts
│  │  │  │  │      │
│  │  │  │  │      └── layout-utils/          # 🆕 佈局工具組件
│  │  │  │  │          ├── layout-utils.component.ts
│  │  │  │  │          ├── layout-utils.component.scss
│  │  │  │  │          └── index.ts
│  │  │  │  │
│  │  │  │  └── widgets/             # ✅ 小部件組件
│  │  │  │      ├── data-table/      # ✅ 數據表格
│  │  │  │      └── user-card/       # ✅ 用戶卡片
│  │  │  │
│  │  │  ├── pages/                  # ✅ 頁面組件
│  │  │  │  ├── app-shell-demo/      # ✅ App Shell 演示
│  │  │  │  ├── auth/                # ✅ 認證頁面
│  │  │  │  │  ├── login/            # ✅ 登入頁面
│  │  │  │  │  └── register/         # ✅ 註冊頁面
│  │  │  │  │
│  │  │  │  ├── dashboard/           # ✅ 儀表板頁面
│  │  │  │  ├── tab-demo/            # ✅ 標籤演示頁面
│  │  │  │  └── user/                # ✅ 用戶頁面
│  │  │  │      ├── user-detail/     # ✅ 用戶詳情
│  │  │  │      └── user-list/       # ✅ 用戶列表
│  │  │  │
│  │  │  ├── controllers/            # ✅ API 控制器
│  │  │  ├── guards/                 # ✅ 路由守衛
│  │  │  ├── interceptors/           # ✅ HTTP 攔截器
│  │  │  ├── pipes/                  # ✅ 數據管道
│  │  │  └── directives/             # ✅ 指令
│  │  │
│  │  ├── 📁 安全層 (Security Layer)
│  │  │  ├── authentication/         # ✅ 認證管理
│  │  │  ├── authorization/          # ✅ 授權管理
│  │  │  ├── encryption/             # ✅ 加密服務
│  │  │  ├── jwt/                    # ✅ JWT 處理
│  │  │  ├── audit/                  # ✅ 安全審計
│  │  │  ├── validation/             # ✅ 安全驗證
│  │  │  └── rate-limiting/          # ✅ 頻率限制
│  │  │
│  │  ├── 📁 共享層 (Shared Layer) - 🆕 佈局系統核心
│  │  │  ├── constants/              # ✅ 常量定義
│  │  │  │  ├── index.ts
│  │  │  │  ├── sidebar.constants.ts
│  │  │  │  └── 🆕 佈局常量
│  │  │  │      ├── layout.constants.ts       # 🆕 佈局系統常量
│  │  │  │      ├── breakpoints.constants.ts  # 🆕 斷點常量
│  │  │  │      ├── spacing.constants.ts      # 🆕 間距常量
│  │  │  │      └── container-query.constants.ts # 🆕 容器查詢常量
│  │  │  │
│  │  │  ├── enums/                  # ✅ 枚舉定義
│  │  │  │  ├── index.ts
│  │  │  │  ├── common/              # ✅ 通用枚舉
│  │  │  │  └── 🆕 佈局枚舉
│  │  │  │      ├── layout.enums.ts           # 🆕 佈局類型枚舉
│  │  │  │      ├── screen-size.enums.ts      # 🆕 螢幕尺寸枚舉
│  │  │  │      └── container-type.enums.ts  # 🆕 容器類型枚舉
│  │  │  │
│  │  │  ├── interfaces/             # ✅ 接口定義
│  │  │  │  ├── index.ts
│  │  │  │  ├── sidebar.interface.ts
│  │  │  │  ├── app-shell/           # ✅ App Shell 接口
│  │  │  │  │  ├── app-shell.interface.ts
│  │  │  │  │  ├── offline.interface.ts
│  │  │  │  │  └── index.ts
│  │  │  │  ├── tab/                 # ✅ 標籤接口
│  │  │  │  │  ├── index.ts
│  │  │  │  │  └── tab.interface.ts
│  │  │  │  └── 🆕 佈局接口
│  │  │  │      ├── layout.interface.ts       # 🆕 佈局系統接口
│  │  │  │      ├── responsive.interface.ts   # 🆕 響應式接口
│  │  │  │      ├── container-query.interface.ts # 🆕 容器查詢接口
│  │  │  │      └── grid-system.interface.ts # 🆕 網格系統接口
│  │  │  │
│  │  │  ├── types/                  # ✅ 類型定義
│  │  │  │  ├── index.ts
│  │  │  │  └── 🆕 佈局類型
│  │  │  │      ├── layout.types.ts           # 🆕 佈局系統類型
│  │  │  │      ├── responsive.types.ts       # 🆕 響應式類型
│  │  │  │      └── container-query.types.ts # 🆕 容器查詢類型
│  │  │  │
│  │  │  ├── utils/                  # ✅ 工具函數
│  │  │  │  ├── index.ts
│  │  │  │  ├── storage.util.ts
│  │  │  │  ├── tab/                 # ✅ 標籤工具
│  │  │  │  │  ├── index.ts
│  │  │  │  │  └── tab.util.ts
│  │  │  │  └── 🆕 佈局工具
│  │  │  │      ├── layout.util.ts           # 🆕 佈局系統工具
│  │  │  │      ├── responsive.util.ts       # 🆕 響應式工具
│  │  │  │      ├── container-query.util.ts  # 🆕 容器查詢工具
│  │  │  │      ├── grid.util.ts             # 🆕 網格系統工具
│  │  │  │      └── breakpoint.util.ts       # 🆕 斷點工具
│  │  │  │
│  │  │  ├── decorators/             # ✅ 通用裝飾器
│  │  │  ├── base/                   # ✅ 基礎抽象類
│  │  │  │  ├── index.ts
│  │  │  │  ├── entities/            # ✅ 基礎實體
│  │  │  │  │  ├── index.ts
│  │  │  │  │  └── base.entity.ts
│  │  │  │  └── 🆕 佈局基礎類
│  │  │  │      ├── layout-base.component.ts # 🆕 佈局基礎組件
│  │  │  │      ├── responsive-base.component.ts # 🆕 響應式基礎組件
│  │  │  │      └── container-query-base.component.ts # 🆕 容器查詢基礎組件
│  │  │  │
│  │  │  ├── i18n/                   # ✅ 國際化
│  │  │  └── services/               # ✅ 共享服務
│  │  │      ├── cache.service.ts
│  │  │      ├── index.ts
│  │  │      ├── material/           # ✅ Material 服務
│  │  │      │  ├── index.ts
│  │  │      │  ├── material-layout.service.ts
│  │  │      │  └── material-theme.service.ts
│  │  │      └── 🆕 佈局服務
│  │  │          ├── layout.service.ts               # 🆕 佈局系統服務
│  │  │          ├── responsive.service.ts            # 🆕 響應式服務
│  │  │          ├── container-query.service.ts       # 🆕 容器查詢服務
│  │  │          ├── grid-system.service.ts           # 🆕 網格系統服務
│  │  │          ├── breakpoint.service.ts            # 🆕 斷點服務
│  │  │          ├── layout-theme.service.ts          # 🆕 佈局主題服務
│  │  │          └── layout-performance.service.ts    # 🆕 佈局性能服務
│  │  │
│  │  ├── 📁 模組層 (Modules Layer)
│  │  │  ├── auth.module.ts          # ✅ 認證模組
│  │  │  ├── user.module.ts          # ✅ 用戶模組
│  │  │  ├── index.ts                # ✅ 模組聚合
│  │  │  └── app-shell/              # ✅ App Shell 模組
│  │  │      ├── app-shell.module.ts
│  │  │      └── index.ts
│  │  │
│  │  └── 📁 樣式系統 (Styles System) - 🆕 現代化樣式架構
│  │      ├── styles.scss            # ✅ 全局樣式
│  │      ├── app-shell/             # ✅ App Shell 樣式
│  │      │  ├── index.scss
│  │      │  ├── _app-shell-accessibility.scss
│  │      │  ├── _app-shell-layout.scss
│  │      │  ├── _app-shell-responsive.scss
│  │      │  ├── _app-shell-theme.scss
│  │      │  └── _app-shell-variables.scss
│  │      │
│  │      └── 🆕 現代化佈局樣式
│  │          ├── layout/                    # 🆕 佈局系統樣式
│  │          │  ├── _layout-system.scss     # 🆕 佈局系統核心
│  │          │  ├── _layout-grid.scss       # 🆕 CSS Grid 系統
│  │          │  ├── _layout-flex.scss       # 🆕 Flexbox 系統
│  │          │  ├── _layout-utils.scss      # 🆕 佈局工具
│  │          │  └── _layout-variables.scss  # 🆕 佈局變量
│  │          │
│  │          ├── responsive/                # 🆕 響應式系統樣式
│  │          │  ├── _responsive-system.scss # 🆕 響應式系統核心
│  │          │  ├── _breakpoints.scss       # 🆕 斷點系統
│  │          │  ├── _media-queries.scss     # 🆕 媒體查詢
│  │          │  └── _responsive-utils.scss  # 🆕 響應式工具
│  │          │
│  │          ├── container-queries/         # 🆕 容器查詢樣式
│  │          │  ├── _container-queries.scss # 🆕 容器查詢核心
│  │          │  ├── _container-types.scss   # 🆕 容器類型
│  │          │  ├── _container-breakpoints.scss # 🆕 容器斷點
│  │          │  └── _container-utils.scss  # 🆕 容器查詢工具
│  │          │
│  │          ├── material/                  # 🆕 Material 3 樣式
│  │          │  ├── _material-theme.scss    # 🆕 Material 主題
│  │          │  ├── _material-colors.scss   # 🆕 Material 顏色
│  │          │  ├── _material-typography.scss # 🆕 Material 字體
│  │          │  ├── _material-elevation.scss # 🆕 Material 陰影
│  │          │  └── _material-density.scss  # 🆕 Material 密度
│  │          │
│  │          ├── components/                # 🆕 組件樣式
│  │          │  ├── _buttons.scss           # 🆕 按鈕樣式
│  │          │  ├── _cards.scss             # 🆕 卡片樣式
│  │          │  ├── _forms.scss             # 🆕 表單樣式
│  │          │  ├── _navigation.scss        # 🆕 導航樣式
│  │          │  └── _tables.scss            # 🆕 表格樣式
│  │          │
│  │          ├── utilities/                 # 🆕 工具類樣式
│  │          │  ├── _spacing.scss           # 🆕 間距工具
│  │          │  ├── _display.scss           # 🆕 顯示工具
│  │          │  ├── _position.scss          # 🆕 定位工具
│  │          │  ├── _flexbox.scss           # 🆕 Flexbox 工具
│  │          │  ├── _grid.scss              # 🆕 Grid 工具
│  │          │  └── _typography.scss        # 🆕 字體工具
│  │          │
│  │          └── themes/                    # 🆕 主題系統
│  │              ├── _light-theme.scss      # 🆕 亮色主題
│  │              ├── _dark-theme.scss       # 🆕 暗色主題
│  │              ├── _high-contrast.scss    # 🆕 高對比主題
│  │              └── _theme-switcher.scss  # 🆕 主題切換器
│  │
│  ├── 📁 資源文件
│  │  ├── assets/                     # ✅ 靜態資源
│  │  │  ├── index.ts
│  │  │  ├── data/                    # ✅ 數據資源
│  │  │  ├── fonts/                   # ✅ 字體資源
│  │  │  ├── icons/                   # ✅ 圖標資源
│  │  │  └── images/                  # ✅ 圖片資源
│  │  │
│  │  ├── environments/               # ✅ 環境配置
│  │  │  ├── environment.ts
│  │  │  └── environment.prod.ts
│  │  │
│  │  └── manifest.webmanifest        # ✅ PWA 清單
│  │
│  └── 📁 文檔
│      ├── 0.modern-angular-tech-stack.md    # ✅ 現代化技術棧
│      ├── 0.Angular-Modernization-Initiative.md  # ✅ 現代化計劃
│      ├── 0.angular_material_layout_guide.md # ✅ 佈局現代化指南
│      ├── 0.new-Tree.md              # ✅ 現代化佈局檔案樹
│      └── TREE.md                    # ✅ 專案結構樹
│
└── 📁 構建輸出
    └── dist/                           # ✅ 生產構建
```

## 🆕 新增現代化佈局組件詳解

### 1. 佈局系統核心組件

#### 1.1 Layout Grid 組件
```typescript
// src/app/interface/components/layout/layout-grid/layout-grid.component.ts
@Component({
  selector: 'app-layout-grid',
  template: `
    <div class="layout-grid" [class]="gridClass" [style]="gridStyles">
      <ng-content />
    </div>
  `,
  styles: [`
    .layout-grid {
      display: grid;
      gap: var(--grid-gap, 1rem);
      padding: var(--grid-padding, 1rem);
    }

    .layout-grid--1-col { grid-template-columns: 1fr; }
    .layout-grid--2-col { grid-template-columns: repeat(2, 1fr); }
    .layout-grid--3-col { grid-template-columns: repeat(3, 1fr); }
    .layout-grid--4-col { grid-template-columns: repeat(4, 1fr); }

    .layout-grid--auto-fit {
      grid-template-columns: repeat(auto-fit, minmax(var(--min-width, 300px), 1fr));
    }

    .layout-grid--auto-fill {
      grid-template-columns: repeat(auto-fill, minmax(var(--min-width, 300px), 1fr));
    }
  `]
})
export class LayoutGridComponent {
  @Input() columns: 1 | 2 | 3 | 4 | 'auto-fit' | 'auto-fill' = 1;
  @Input() minWidth = '300px';
  @Input() gap = '1rem';
  @Input() padding = '1rem';

  get gridClass(): string {
    if (typeof this.columns === 'number') {
      return `layout-grid--${this.columns}-col`;
    }
    return `layout-grid--${this.columns}`;
  }

  get gridStyles(): { [key: string]: string } {
    return {
      '--min-width': this.minWidth,
      '--grid-gap': this.gap,
      '--grid-padding': this.padding
    };
  }
}
```

#### 1.2 Container Query 組件
```typescript
// src/app/interface/components/layout/container-query/container-query.component.ts
@Component({
  selector: 'app-container-query',
  template: `
    <div class="container-query" [class]="containerClass" [style]="containerStyles">
      <ng-content />
    </div>
  `,
  styles: [`
    .container-query {
      container-type: inline-size;
    }

    .container-query--small { container-name: small; }
    .container-query--medium { container-name: medium; }
    .container-query--large { container-name: large; }

    @container small (min-width: 400px) {
      .responsive-content {
        display: grid;
        grid-template-columns: 1fr;
      }
    }

    @container medium (min-width: 800px) {
      .responsive-content {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @container large (min-width: 1200px) {
      .responsive-content {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  `]
})
export class ContainerQueryComponent {
  @Input() size: 'small' | 'medium' | 'large' = 'medium';
  @Input() minWidth = '400px';

  get containerClass(): string {
    return `container-query--${this.size}`;
  }

  get containerStyles(): { [key: string]: string } {
    return {
      '--min-width': this.minWidth
    };
  }
}
```

### 2. 佈局服務系統

#### 2.1 佈局系統服務
```typescript
// src/app/shared/services/layout/layout.service.ts
@Injectable({ providedIn: 'root' })
export class LayoutService {
  private readonly _currentLayout = signal<LayoutType>('default');
  readonly currentLayout = this._currentLayout.asReadonly();

  private readonly _layoutConfig = signal<LayoutConfig>({
    sidebar: { width: '250px', collapsed: false },
    header: { height: '64px', sticky: true },
    content: { padding: '1rem', maxWidth: '1200px' }
  });
  readonly layoutConfig = this._layoutConfig.asReadonly();

  // 動態調整佈局
  updateLayout(type: LayoutType) {
    this._currentLayout.set(type);
    this.applyLayoutConfig(type);
  }

  // 響應式佈局調整
  adjustLayoutForScreenSize(screenSize: ScreenSize) {
    const config = this.getLayoutConfigForScreen(screenSize);
    this._layoutConfig.set(config);
  }

  private applyLayoutConfig(type: LayoutType) {
    // 應用佈局配置
  }

  private getLayoutConfigForScreen(screenSize: ScreenSize): LayoutConfig {
    switch (screenSize) {
      case 'xs':
        return {
          sidebar: { width: '100%', collapsed: true },
          header: { height: '56px', sticky: false },
          content: { padding: '0.5rem', maxWidth: '100%' }
        };
      case 'sm':
        return {
          sidebar: { width: '200px', collapsed: false },
          header: { height: '64px', sticky: true },
          content: { padding: '1rem', maxWidth: '100%' }
        };
      default:
        return {
          sidebar: { width: '250px', collapsed: false },
          header: { height: '64px', sticky: true },
          content: { padding: '1rem', maxWidth: '1200px' }
        };
    }
  }
}
```

#### 2.2 響應式服務
```typescript
// src/app/shared/services/layout/responsive.service.ts
@Injectable({ providedIn: 'root' })
export class ResponsiveService {
  private readonly breakpointObserver = inject(BreakpointObserver);

  // 響應式佈局狀態
  readonly layoutState = computed(() => {
    const isHandset = this.breakpointObserver.isMatched(Breakpoints.Handset);
    const isTablet = this.breakpointObserver.isMatched(Breakpoints.Tablet);
    const isWeb = this.breakpointObserver.isMatched(Breakpoints.Web);

    return {
      isHandset,
      isTablet,
      isWeb,
      isMobile: isHandset || isTablet,
      isDesktop: isWeb
    };
  });

  // 容器查詢觀察器
  observeContainer(container: Element, breakpoints: string[]) {
    return new ResizeObserver(entries => {
      entries.forEach(entry => {
        const { width } = entry.contentRect;
        this.handleContainerResize(width, breakpoints);
      });
    });
  }

  private handleContainerResize(width: number, breakpoints: string[]) {
    // 處理容器尺寸變化
  }
}
```

### 3. 現代化樣式系統

#### 3.1 佈局系統核心樣式
```scss
// src/styles/layout/_layout-system.scss
:root {
  // 間距系統
  --spacing-xs: 0.5rem;
  --spacing-sm: 1rem;
  --spacing-md: 1.5rem;
  --spacing-lg: 2rem;
  --spacing-xl: 3rem;

  // 斷點系統
  --breakpoint-xs: 600px;
  --breakpoint-sm: 960px;
  --breakpoint-md: 1280px;
  --breakpoint-lg: 1920px;

  // 容器查詢斷點
  --container-small: 400px;
  --container-medium: 800px;
  --container-large: 1200px;

  // 佈局變量
  --layout-max-width: 1200px;
  --layout-sidebar-width: 250px;
  --layout-header-height: 64px;
  --layout-content-padding: 1rem;
}

// 佈局工具類
.layout-container {
  max-width: var(--layout-max-width);
  margin: 0 auto;
  padding: 0 var(--layout-content-padding);
}

.layout-sidebar {
  width: var(--layout-sidebar-width);
  transition: width 0.3s ease;
}

.layout-header {
  height: var(--layout-header-height);
  position: sticky;
  top: 0;
  z-index: 1000;
}
```

#### 3.2 響應式系統樣式
```scss
// src/styles/responsive/_responsive-system.scss
// 移動優先的響應式設計
.responsive-component {
  // 移動端樣式（默認）
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);

  // 平板端樣式
  @media (min-width: 768px) {
    flex-direction: row;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
  }

  // 桌面端樣式
  @media (min-width: 1024px) {
    gap: var(--spacing-lg);
    padding: var(--spacing-lg);
  }
}

// 響應式網格系統
.responsive-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--spacing-sm);

  @media (min-width: 600px) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 960px) {
    grid-template-columns: repeat(3, 1fr);
  }

  @media (min-width: 1280px) {
    grid-template-columns: repeat(4, 1fr);
  }
}
```

#### 3.3 容器查詢樣式
```scss
// src/styles/container-queries/_container-queries.scss
// 容器查詢工具類
.container-query {
  &--small {
    container-type: inline-size;
    container-name: small;
  }

  &--medium {
    container-type: inline-size;
    container-name: medium;
  }

  &--large {
    container-type: inline-size;
    container-name: large;
  }
}

// 響應式工具類
@container small (min-width: 400px) {
  .responsive-content {
    display: grid;
    grid-template-columns: 1fr;
  }
}

@container medium (min-width: 800px) {
  .responsive-content {
    grid-template-columns: repeat(2, 1fr);
  }
}

@container large (min-width: 1200px) {
  .responsive-content {
    grid-template-columns: repeat(3, 1fr);
  }
}
```

## 📱 實施路徑與優先級

### 第一階段：基礎佈局現代化（2-3週）
1. **建立現代化佈局基礎設施**
   - 創建佈局常量文件
   - 實現 Container Queries 工具類
   - 建立響應式斷點系統

2. **升級現有組件佈局**
   - 選擇一個簡單的組件進行試點
   - 建立 Container Queries 使用規範
   - 逐步替換傳統 Media Queries

### 第二階段：組件佈局升級（3-4週）
1. **建立佈局組件庫**
   - Layout Grid 組件
   - Layout Flex 組件
   - Container Query 組件
   - Responsive Container 組件

2. **實現動態佈局系統**
   - 佈局服務
   - 響應式服務
   - 容器查詢服務

### 第三階段：高級佈局功能（4-5週）
1. **實現佈局主題系統**
   - 佈局主題服務
   - 動態主題切換
   - 高對比主題支援

2. **性能優化**
   - 佈局性能優化
   - 虛擬滾動支援
   - 懶加載佈局

## 🎯 關鍵成功因素

1. **漸進式升級** - 不要一次性重寫所有佈局代碼
2. **性能優先** - 優先升級影響性能的佈局技術
3. **團隊培訓** - 組織現代化佈局技術培訓
4. **實用性導向** - 避免過度理論化，注重實際實施

## 📊 預期效果

- **佈局性能**: 提升 40-60%
- **響應式設計**: 提升 50-70%
- **組件重用性**: 提升 60-80%
- **開發效率**: 提升 50%

---

**總結**: 這份檔案樹確保了實用性和可實施性，避免了過度理論化和理想化。通過系統性的佈局現代化升級，您的專案將能夠充分利用 Angular 20 的最新佈局技術，實現真正的組件級響應式設計，提升開發效率和用戶體驗。
