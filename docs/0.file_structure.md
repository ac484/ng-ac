## 最終專案結構樹（依據 `docs/0.TREE.md` 並套用職責收斂）

### 變更重點（手搓精簡版）
- **守衛統一**：所有路由守衛集中於 `src/app/interface/guards`。
- **攔截器統一**：所有 HTTP 攔截器集中於 `src/app/infrastructure/interceptors`。
- **認證/授權收斂**：由 `infrastructure/security` 提供自製 token/會話與刷新服務；`application/use-cases` 協作流程；`domain/services` 定義規則；UI 僅透過 Facade/UseCase。
- **Core 邊界**：`core` 僅保留啟動/提供者聚合，不再承載具體守衛或攔截器實作。
- **Modules（可選/待退場）**：如採 Standalone，`modules/*` 僅作聚合或逐步移除。

### 結構樹（最終目標狀態）

```text
src/
  app/
    app.component.ts
    app.config.ts                 # 攔截器與全域 providers 聚合註冊入口
    app.routes.ts                 # 路由：介面層守衛於此掛載

    application/
      index.ts
      use-cases/
        index.ts
        login.use-case.ts
        register.use-case.ts
        # 其他用例...
      services/
        index.ts
        auth.facade.ts            # 可選：UI 專用 Facade，避免觸及 infra
      commands/
        index.ts
        # ...
      queries/
        index.ts
      dto/
        index.ts
        auth.dto.ts
        user.dto.ts
      validators/
        index.ts
      mappers/
        index.ts

    domain/
      index.ts
      entities/
        index.ts
        user/
          index.ts
          user.entity.ts
        app-shell/
          index.ts
          app-shell.entity.ts
          app-shell.factory.ts
        # ...
      value-objects/
        index.ts
        email/
          index.ts
          email.vo.ts
        # ...
      services/
        index.ts
        auth.domain.service.ts    # 授權規則/驗證規格（無框架依賴）
      repositories/
        index.ts
        user.repository.ts
      events/
        index.ts
      specifications/
        index.ts

    infrastructure/
      index.ts
      config/
        index.ts
        environment.service.ts
        firebase/
          index.ts
          firebase.config.ts
      logging/
        index.ts
        logger.service.ts
      caching/
        index.ts
        cache.service.ts
      monitoring/
        index.ts
      messaging/
        index.ts
      external-services/
        index.ts
        pwa/
          index.ts
          service-worker.service.ts
      persistence/
        index.ts
        firebase/
          index.ts
          firebase.service.ts
          firestore.service.ts
          firebase-auth.service.ts  # Firebase 適配層（對接自製 token 策略）
        repositories/
          firebase/
            index.ts
            firebase-base.repository.ts
            user/
              index.ts
              user.firebase.repository.ts
      security/
        index.ts
        token-storage.service.ts   # 自製 token/會話存儲（localStorage/Memory/IndexedDB）
        refresh-token.service.ts   # 從 core/net 移入，供攔截器使用
      interceptors/
        auth-http.interceptor.ts   # 附掛 Authorization / 統一 401/403 處理
        error.interceptor.ts
        logging.interceptor.ts

    interface/
      index.ts
      controllers/
        index.ts
      interceptors/
        index.ts                   # 僅 barrel（無具體攔截器實作）
      guards/
        index.ts
        auth.guard.ts              # 路由守衛（依賴 Facade/UseCase）
        permission.guard.ts
        role.guard.ts
      components/
        index.ts
        layout/
          index.ts
          header/
            index.ts
            header.component.ts
          sidebar/
            index.ts
            sidebar.component.ts
            sidebar.component.html
            sidebar.component.scss
          footer/
            index.ts
            footer.component.ts
          layout-grid/
            index.ts
            layout-grid.component.ts
          app-shell/
            index.ts
            app-shell.component.ts
            app-shell.component.scss
          # 其他現有佈局/工具元件...
        common/
          index.ts
          tab-navigation/
            index.ts
            tab-navigation.component.ts
            tab-navigation.component.scss
        forms/
          index.ts
          login-form/
            index.ts
            login-form.component.ts
          user-form/
            index.ts
            user-form.component.ts
        widgets/
          index.ts
          data-table/
            index.ts
            data-table.component.ts
          user-card/
            index.ts
            user-card.component.ts
      layouts/
        index.ts
        main-app/
          index.ts
          main-app.layout.ts
        passport/
          index.ts
          passport.layout.ts
      pages/
        index.ts
        app-shell/
          index.ts
          app-shell.page.ts
        auth/
          index.ts
          login/
            index.ts
            login.page.ts
          register/
            index.ts
            register.page.ts
        dashboard/
          index.ts
          dashboard.page.ts
        tab-demo/
          index.ts
          tab-demo.page.ts
          tab-demo.page.scss
        user/
          index.ts
          user-detail/
            index.ts
            user-detail.page.ts
          user-list/
            index.ts
            user-list.page.ts
      pipes/
        index.ts
      directives/
        index.ts
      exceptions/
        index.ts
      resolvers/
        index.ts

    core/
      index.ts
      services.ts                  # 僅保留 providers/啟動聚合
      i18n/
        index.ts
        i18n.service.ts
      net/
        index.ts                   # 如仍有共用網路工具可保留（不含攔截器實作）
      startup/
        index.ts
        startup.service.ts

    security/                      # 既有目錄（逐步收斂 → infra/interface/application）
      _archive/                    # 舊有實作暫存（完成收斂後可移除）
        authentication/
        authorization/
        # 其餘歷史檔案...

    shared/
      index.ts
      components/
        index.ts
        material/                  # 精簡保留：確實跨域重用者
          index.ts
          material-layout.service.ts
          material-theme.service.ts
          modern-breakpoint.service.ts
          # 其餘僅示範/不常用的 wrapper 建議遷至 docs/playground
      constants/
        index.ts
        layout/
          index.ts
          layout.constants.ts
        tab/
          index.ts
          tab.constants.ts
        sidebar.constants.ts
      interfaces/
        index.ts
        layout/
          index.ts
          layout.interface.ts
          sidebar.interface.ts
        app-shell/
          index.ts
          app-shell.interface.ts
          offline.interface.ts
        tab/
          index.ts
          tab.interface.ts
      services/
        index.ts
        cache.service.ts
        material/
          index.ts
          material-layout.service.ts
          material-theme.service.ts
          modern-breakpoint.service.ts
      utils/
        index.ts
        storage.util.ts
        tab/
          index.ts
          tab.util.ts
      enums/
        index.ts
        common/
          index.ts
      types/
        index.ts
      validators/
        index.ts

    modules/                        # 可選/待退場（Standlone 化後可移除或僅保留 barrel）
      index.ts
      auth.module.ts
      user.module.ts
      app-shell/
        index.ts
        app-shell.module.ts

  assets/
    index.ts
    data/
      index.ts
    fonts/
      index.ts
    icons/
      index.ts
      icon-*.png
    images/
      index.ts

  environments/
    environment.ts
    environment.prod.ts

  styles/
    app-shell/
      index.scss
      _app-shell-accessibility.scss
      _app-shell-layout.scss
      _app-shell-responsive.scss
      _app-shell-theme.scss
      _app-shell-variables.scss
      _container-queries.scss
      _layout-grid.scss
```

### 驗收重點
- 路由守衛唯一路徑：`src/app/interface/guards/*`
- HTTP 攔截器唯一路徑：`src/app/infrastructure/interceptors/*`
- Token/會話統一：`src/app/infrastructure/security/*`
- UI 僅透過 `application/services/auth.facade.ts` 或 UseCase 存取認證流程
- `core` 不再承載具體守衛/攔截器實作
- `modules/*` 非必要依賴，可逐步退場


