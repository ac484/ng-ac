# 檔案結構遷移計畫（最小實施版）

> 依據 `docs/0.TREE.md`（當前）與 `docs/0.new-Tree.md`（目標）比對，列出「需要遷移/歸檔/校驗」的最小清單。遵循：不破壞現有功能、優先極簡、可回滾。

---

## 目標對齊要點（摘要）
- **路由劃分**：`/auth/**` → `PassportLayoutComponent`；`/app/**` → `MainAppLayoutComponent`。
- **唯一側欄**：側欄組件集中於 `interface/components/layout/sidebar/*`。
- **佈局契約集中**：佈局相關型別/介面集中於 `shared/interfaces/layout/*`。
- **常量位置**：佈局常量位於 `shared/constants/layout/layout.constants.ts`。

---

## A. 需要「移動/合併」的檔案

- 側欄（如仍殘留於 Shared）：
  - from: `src/app/shared/components/sidebar/*`
  - to:   `src/app/interface/components/layout/sidebar/*`

- 佈局介面（若仍存在舊路徑）：
  - from: `src/app/shared/interfaces/sidebar.interface.ts`
  - to:   `src/app/shared/interfaces/layout/sidebar.interface.ts`

- 可選：`app-shell`（若存在 Layout 版本且僅作為視覺組件使用）
  - from: `src/app/interface/layouts/app-shell/*`
  - to:   `src/app/interface/components/layout/app-shell/*`
  - 說明：若 `app-shell.layout.ts` 僅承擔視覺呈現，應歸入 components；若作為路由容器，則保留於 layouts。

---

## B. 需要「歸檔（暫不刪除）」的檔案/資料夾

> 先歸檔至 `_archive`，觀察一個迭代後再決定刪除，以確保不破壞功能。

- 其他歷史 Layout（若未被路由直接使用）：
  - `src/app/interface/layouts/basic/*` → `src/app/interface/layouts/_archive/basic/*`
  - `src/app/interface/layouts/blank/*` → `src/app/interface/layouts/_archive/blank/*`
  - `src/app/interface/layouts/dashboard/*` → `src/app/interface/layouts/_archive/dashboard/*`
  - 說明：新規範僅保留 `passport` 與 `main-app` 作為容器。

- 重疊/重複的側欄實作（若與新位置重複）：
  - `src/app/shared/components/sidebar/*` → `src/app/interface/layouts/_archive/sidebar_legacy/*`

---

## C. 需要「校驗/補齊」但不搬動的項目

- 佈局相關常量已存在並位置正確：
  - `src/app/shared/constants/layout/layout.constants.ts`（確認存在與對外匯出）

- Tab Navigation 位置與導出：
  - `src/app/interface/components/common/tab-navigation/*`（確認僅此一份，`index.ts` 導出完整）

- 佈局介面集中：
  - `src/app/shared/interfaces/layout/*.ts`（確認 `layout.interface.ts`、`sidebar.interface.ts` 等完整）

- Material 服務位置：
  - `src/app/shared/services/material/*`（`material-layout.service.ts`、`material-theme.service.ts`、`modern-breakpoint.service.ts`）

---

## D. 路由對齊（僅校驗）
- `src/app/app.routes.ts` 中應有兩個頂層路徑：
  - `/auth/**` 使用 `PassportLayoutComponent`
  - `/app/**` 使用 `MainAppLayoutComponent`
- 其它歷史 Layout 若仍被使用，先納入 `_archive` 前請替換為上述兩個容器；如短期仍需，保留但標記為 deprecated。

---

## E. 建議的移動指令（PowerShell / Git）

```powershell
# 分支保護
git checkout -b chore/structure-align-min

# A. 移動/合併
if (Test-Path src/app/shared/components/sidebar) {
  git mv src/app/shared/components/sidebar/* src/app/interface/components/layout/sidebar/
  git rm -r src/app/shared/components/sidebar
}

if (Test-Path src/app/shared/interfaces/sidebar.interface.ts) {
  mkdir src/app/shared/interfaces/layout -Force | Out-Null
  git mv src/app/shared/interfaces/sidebar.interface.ts src/app/shared/interfaces/layout/sidebar.interface.ts
}

# 可選：app-shell（僅視覺用途時）
if (Test-Path src/app/interface/layouts/app-shell) {
  mkdir src/app/interface/components/layout/app-shell -Force | Out-Null
  git mv src/app/interface/layouts/app-shell/* src/app/interface/components/layout/app-shell/
  git rm -r src/app/interface/layouts/app-shell
}

# B. 歸檔
mkdir src/app/interface/layouts/_archive -Force | Out-Null
if (Test-Path src/app/interface/layouts/basic) { git mv src/app/interface/layouts/basic src/app/interface/layouts/_archive/basic }
if (Test-Path src/app/interface/layouts/blank) { git mv src/app/interface/layouts/blank src/app/interface/layouts/_archive/blank }
if (Test-Path src/app/interface/layouts/dashboard) { git mv src/app/interface/layouts/dashboard src/app/interface/layouts/_archive/dashboard }

# 歸檔 legacy sidebar（如與新位置重複）
if (Test-Path src/app/shared/components/sidebar) {
  mkdir src/app/interface/layouts/_archive/sidebar_legacy -Force | Out-Null
  git mv src/app/shared/components/sidebar/* src/app/interface/layouts/_archive/sidebar_legacy/
  git rm -r src/app/shared/components/sidebar
}

# 提交
git add -A
git commit -m "chore(structure): align layouts & sidebar to clear structure; archive legacy"
```

---

## F. 後續收斂（不阻塞本次遷移）
- 清查 `interface/layouts/_archive/*` 是否仍被路由引用；一個迭代後若無使用，移除。
- 梳理 `shared/components/material/*` 為示例/內部 demo 時，移至 `docs/` 或建立 `interface/components/demo/*`，避免與生產組件混淆（需另開 PR）。

---

## 驗收清單（與 `0.new-Tree.md` 對齊）
- [ ] `/auth/**` 使用 `PassportLayoutComponent`
- [ ] `/app/**` 使用 `MainAppLayoutComponent`
- [ ] 唯一側欄實作位於 `interface/components/layout/sidebar/*`
- [ ] 佈局契約集中於 `shared/interfaces/layout/*`
- [ ] 歷史/重複佈局已歸檔於 `interface/layouts/_archive/*`

---

## 風險與回滾
- 所有動作為 `git mv`，可透過 `git revert` 或刪除分支回滾。
- 歸檔不等於刪除，確保一個迭代觀察期後再清理。
