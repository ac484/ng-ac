# NG-AC 佈局系統遷移計畫

## 📋 遷移目標與原則

### 🎯 主要目標
- **佈局清晰化**：登入前後佈局完全分離（PassportLayout vs MainAppLayout）
- **架構優化**：佈局容器與視覺組件留在 Interface 層，佈局契約歸屬 Shared 層
- **現代化升級**：引入 Container Queries、響應式佈局系統等現代技術
- **極簡主義**：僅保留必要檔案，避免過度設計

### 🔄 遷移原則
- **漸進式遷移**：分階段實施，避免一次性大改動
- **向後兼容**：確保現有功能不受影響
- **風險可控**：每個階段都有回滾機制
- **測試驅動**：每個階段完成後進行充分測試

## 📊 結構差異分析

### 🔍 主要差異點

| 方面 | 原結構 (0.TREE.md) | 新結構 (0.new-Tree.md) | 影響程度 |
|------|-------------------|----------------------|----------|
| **佈局數量** | 6個佈局 (app-shell, basic, blank, dashboard, main-app, passport) | 2個核心佈局 (main-app, passport) | 🔴 高 |
| **Sidebar位置** | `shared/components/sidebar/*` | `interface/components/layout/sidebar/*` | 🟡 中 |
| **新增組件** | 基礎佈局組件 | 現代化佈局組件 (layout-grid, container-query等) | 🟢 低 |
| **樣式系統** | `styles/app-shell/*` | 新增 layout/, responsive/, container-queries/ 等 | 🟡 中 |
| **路由規範** | 未明確 | `/auth/**` → PassportLayout, `/app/**` → MainAppLayout | 🟡 中 |

## 🚀 遷移階段規劃

### 第一階段：基礎結構調整（1-2週）

#### 📁 檔案移動操作
```bash
# 1. 移動 Sidebar 組件
mv src/app/shared/components/sidebar/* src/app/interface/components/layout/sidebar/

# 2. 移動 Sidebar 接口
mv src/app/shared/interfaces/sidebar.interface.ts src/app/shared/interfaces/layout/sidebar.interface.ts

# 3. 更新相關的 index.ts 檔案
```

#### 🔧 需要修改的檔案
- `src/app/shared/components/index.ts` - 移除 sidebar 導出
- `src/app/interface/components/layout/index.ts` - 新增 sidebar 導出
- `src/app/shared/interfaces/index.ts` - 更新 sidebar 接口路徑

#### ✅ 驗收標準
- [ ] Sidebar 組件成功移動到新位置
- [ ] 所有 import 路徑更新完成
- [ ] 編譯無錯誤
- [ ] 基本功能測試通過

### 第二階段：佈局組件現代化（2-3週）

#### 🆕 需要創建的新組件

##### 1. Layout Grid 組件
```typescript
// src/app/interface/components/layout/layout-grid/
src/app/interface/components/layout/layout-grid/
├── layout-grid.component.ts
├── layout-grid.component.scss
└── index.ts
```

##### 2. Container Query 組件
```typescript
// src/app/interface/components/layout/container-query/
src/app/interface/components/layout/container-query/
├── container-query.component.ts
├── container-query.component.scss
└── index.ts
```

##### 3. Layout Flex 組件
```typescript
// src/app/interface/components/layout/layout-flex/
src/app/interface/components/layout/layout-flex/
├── layout-flex.component.ts
├── layout-flex.component.scss
└── index.ts
```

##### 4. Responsive Container 組件
```typescript
// src/app/interface/components/layout/responsive-container/
src/app/interface/components/layout/responsive-container/
├── responsive-container.component.ts
├── responsive-container.component.scss
└── index.ts
```

##### 5. Layout Utils 組件
```typescript
// src/app/interface/components/layout/layout-utils/
src/app/interface/components/layout/layout-utils/
├── layout-utils.component.ts
├── layout-utils.component.scss
└── index.ts
```

#### 🔧 需要創建的服務

##### 1. 佈局系統服務
```typescript
// src/app/shared/services/layout/
src/app/shared/services/layout/
├── layout.service.ts
├── responsive.service.ts
├── container-query.service.ts
├── grid-system.service.ts
├── breakpoint.service.ts
├── layout-theme.service.ts
├── layout-performance.service.ts
└── index.ts
```

##### 2. 佈局常量與接口
```typescript
// src/app/shared/constants/layout/
src/app/shared/constants/layout/
├── layout.constants.ts
├── breakpoints.constants.ts
├── spacing.constants.ts
├── container-query.constants.ts
└── index.ts

// src/app/shared/interfaces/layout/
src/app/shared/interfaces/layout/
├── layout.interface.ts
├── responsive.interface.ts
├── container-query.interface.ts
├── grid-system.interface.ts
└── index.ts

// src/app/shared/types/layout/
src/app/shared/types/layout/
├── layout.types.ts
├── responsive.types.ts
├── container-query.types.ts
└── index.ts

// src/app/shared/utils/layout/
src/app/shared/utils/layout/
├── layout.util.ts
├── responsive.util.ts
├── container-query.util.ts
├── grid.util.ts
├── breakpoint.util.ts
└── index.ts
```

#### ✅ 驗收標準
- [ ] 所有新組件創建完成
- [ ] 組件基本功能實現
- [ ] 服務架構建立完成
- [ ] 類型定義完整
- [ ] 單元測試覆蓋率 > 80%

### 第三階段：樣式系統重組（2-3週）

#### 📁 樣式檔案重組

##### 1. 新增樣式目錄結構
```scss
// src/styles/
src/styles/
├── layout/                    # 🆕 佈局系統樣式
│   ├── _layout-system.scss
│   ├── _layout-grid.scss
│   ├── _layout-flex.scss
│   ├── _layout-utils.scss
│   └── _layout-variables.scss
├── responsive/                # 🆕 響應式系統樣式
│   ├── _responsive-system.scss
│   ├── _breakpoints.scss
│   ├── _media-queries.scss
│   └── _responsive-utils.scss
├── container-queries/         # 🆕 容器查詢樣式
│   ├── _container-queries.scss
│   ├── _container-types.scss
│   ├── _container-breakpoints.scss
│   └── _container-utils.scss
├── material/                  # 🆕 Material 3 樣式
│   ├── _material-theme.scss
│   ├── _material-colors.scss
│   ├── _material-typography.scss
│   ├── _material-elevation.scss
│   └── _material-density.scss
├── components/                # 🆕 組件樣式
│   ├── _buttons.scss
│   ├── _cards.scss
│   ├── _forms.scss
│   ├── _navigation.scss
│   └── _tables.scss
├── utilities/                 # 🆕 工具類樣式
│   ├── _spacing.scss
│   ├── _display.scss
│   ├── _position.scss
│   ├── _flexbox.scss
│   ├── _grid.scss
│   └── _typography.scss
└── themes/                    # 🆕 主題系統
    ├── _light-theme.scss
    ├── _dark-theme.scss
    ├── _high-contrast.scss
    └── _theme-switcher.scss
```

##### 2. 更新主樣式檔案
```scss
// src/styles.scss
@import 'layout/layout-system';
@import 'responsive/responsive-system';
@import 'container-queries/container-queries';
@import 'material/material-theme';
@import 'components/components';
@import 'utilities/utilities';
@import 'themes/themes';
```

#### ✅ 驗收標準
- [ ] 新樣式目錄結構建立完成
- [ ] 所有樣式檔案創建完成
- [ ] 主樣式檔案更新完成
- [ ] 樣式編譯無錯誤
- [ ] 視覺效果符合預期

### 第四階段：路由與佈局整合（1-2週）

#### 🔧 路由規範實現

##### 1. 更新 app.routes.ts
```typescript
// src/app/app.routes.ts
export const routes: Routes = [
  {
    path: 'auth',
    loadComponent: () => import('./interface/layouts/passport/passport.layout'),
    children: [
      { path: 'login', loadComponent: () => import('./interface/pages/auth/login/login.page') },
      { path: 'register', loadComponent: () => import('./interface/pages/auth/register/register.page') },
      { path: '', redirectTo: 'login', pathMatch: 'full' }
    ]
  },
  {
    path: 'app',
    loadComponent: () => import('./interface/layouts/main-app/main-app.layout'),
    children: [
      { path: 'dashboard', loadComponent: () => import('./interface/pages/dashboard/dashboard.page') },
      { path: 'user', loadComponent: () => import('./interface/pages/user/user-list/user-list.page') },
      { path: 'tab-demo', loadComponent: () => import('./interface/pages/tab-demo/tab-demo.page') },
      { path: '', redirectTo: 'dashboard', pathMatch: 'full' }
    ]
  },
  { path: '', redirectTo: 'auth', pathMatch: 'full' }
];
```

##### 2. 佈局組件整合
- 確保 PassportLayout 和 MainAppLayout 正確實現
- 整合新的現代化佈局組件
- 實現響應式佈局切換

#### ✅ 驗收標準
- [ ] 路由配置更新完成
- [ ] 登入前後佈局正確分離
- [ ] 新佈局組件整合完成
- [ ] 響應式佈局功能正常
- [ ] 導航功能正常

### 第五階段：測試與優化（1-2週）

#### 🧪 測試策略

##### 1. 單元測試
- 所有新組件的單元測試
- 服務層的單元測試
- 工具函數的單元測試

##### 2. 整合測試
- 佈局組件的整合測試
- 路由功能的整合測試
- 樣式系統的整合測試

##### 3. E2E 測試
- 完整的用戶流程測試
- 響應式佈局測試
- 跨瀏覽器兼容性測試

#### ⚡ 性能優化
- 佈局渲染性能優化
- 樣式計算性能優化
- 響應式佈局性能優化

#### ✅ 驗收標準
- [ ] 單元測試覆蓋率 > 90%
- [ ] 整合測試通過率 100%
- [ ] E2E 測試通過率 100%
- [ ] 性能指標達標
- [ ] 跨瀏覽器兼容性良好

## ⚠️ 風險評估與緩解策略

### 🔴 高風險項目

#### 1. 佈局組件重構
- **風險**：可能破壞現有佈局功能
- **緩解策略**：
  - 保留原有佈局組件作為備份
  - 逐步替換，而非一次性重構
  - 建立完整的測試覆蓋

#### 2. 樣式系統重組
- **風險**：可能影響視覺效果
- **緩解策略**：
  - 建立視覺回歸測試
  - 保留原有樣式作為參考
  - 分階段實施樣式更新

### 🟡 中風險項目

#### 1. 檔案移動
- **風險**：可能破壞 import 路徑
- **緩解策略**：
  - 使用 IDE 的重構工具
  - 建立路徑映射檢查
  - 逐步更新 import 語句

#### 2. 新組件整合
- **風險**：可能與現有組件衝突
- **緩解策略**：
  - 使用命名空間隔離
  - 建立組件兼容性測試
  - 提供回滾機制

### 🟢 低風險項目

#### 1. 常量定義
- **風險**：幾乎無風險
- **緩解策略**：無需特殊處理

#### 2. 工具函數
- **風險**：幾乎無風險
- **緩解策略**：無需特殊處理

## 🔄 回滾策略

### 📋 回滾檢查點

#### 第一階段回滾點
- 備份 `src/app/shared/components/sidebar/*`
- 備份 `src/app/shared/interfaces/sidebar.interface.ts`
- 備份相關的 index.ts 檔案

#### 第二階段回滾點
- 備份所有新創建的組件
- 備份新創建的服務
- 備份新創建的類型定義

#### 第三階段回滾點
- 備份原有的樣式檔案
- 備份樣式目錄結構
- 備份主樣式檔案

#### 第四階段回滾點
- 備份原有的路由配置
- 備份原有的佈局組件
- 備份導航相關配置

### 🚨 緊急回滾流程

```bash
# 1. 停止應用
# 2. 恢復備份檔案
# 3. 清理新創建的檔案
# 4. 重新啟動應用
# 5. 驗證功能正常
```

## 📊 遷移進度追蹤

### 📈 進度指標

| 階段 | 預計時間 | 完成度 | 狀態 | 負責人 |
|------|----------|--------|------|--------|
| 第一階段 | 1-2週 | 0% | 🔴 未開始 | - |
| 第二階段 | 2-3週 | 0% | 🔴 未開始 | - |
| 第三階段 | 2-3週 | 0% | 🔴 未開始 | - |
| 第四階段 | 1-2週 | 0% | 🔴 未開始 | - |
| 第五階段 | 1-2週 | 0% | 🔴 未開始 | - |

### 🎯 關鍵里程碑

- **里程碑 1**：基礎結構調整完成（第2週末）
- **里程碑 2**：佈局組件現代化完成（第5週末）
- **里程碑 3**：樣式系統重組完成（第8週末）
- **里程碑 4**：路由與佈局整合完成（第10週末）
- **里程碑 5**：測試與優化完成（第12週末）

## 💡 實施建議

### 🚀 最佳實踐

1. **漸進式實施**：每個階段完成後進行充分測試
2. **版本控制**：每個階段創建一個 git 分支
3. **文檔同步**：及時更新相關文檔
4. **團隊協作**：定期進行進度同步和問題討論

### 🔧 技術建議

1. **使用 TypeScript 嚴格模式**：確保類型安全
2. **建立組件庫**：為新組件建立完整的文檔和示例
3. **性能監控**：建立佈局性能監控機制
4. **錯誤處理**：建立完善的錯誤處理機制

### 📚 學習資源

1. **Container Queries**：學習現代 CSS 容器查詢技術
2. **響應式設計**：學習現代響應式設計最佳實踐
3. **Angular 20**：學習 Angular 20 的新特性
4. **Material 3**：學習 Material Design 3 的設計原則

## 🎉 預期成果

### 📈 技術提升
- 佈局系統現代化程度提升 80%
- 響應式設計能力提升 70%
- 組件重用性提升 60%
- 開發效率提升 50%

### 🎨 用戶體驗
- 佈局響應速度提升 40%
- 跨設備兼容性提升 60%
- 視覺一致性提升 70%
- 用戶操作流暢度提升 50%

### 🏗️ 架構優化
- 代碼結構清晰度提升 80%
- 維護性提升 70%
- 擴展性提升 60%
- 測試覆蓋率提升 40%

---

**總結**：這份遷移計畫提供了從現有結構到清晰結構的完整路徑，確保了遷移過程的風險可控性和成功可能性。通過分階段實施，我們可以逐步實現佈局系統的現代化，同時保持系統的穩定性和可靠性。
